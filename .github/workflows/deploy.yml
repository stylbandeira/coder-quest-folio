name: ğŸš€ Deploy Manual Fix

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: ğŸšš Baixar cÃ³digo
      uses: actions/checkout@v4
    
    - name: â” Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Instalar dependÃªncias
      run: npm ci
      
    - name: ğŸ—ï¸ Construir projeto
      run: npm run build
      
    - name: ğŸ”§ Criar HTML correto manualmente
      run: |
        # Entra na pasta dist
        cd dist
        
        # Cria um novo index.html CORRETO baseado nos arquivos reais
        cat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dev Portfolio</title>
    <script type="module" crossorigin src="./assets/index-Bn45uE_U.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-xfp6jN1l.css">
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
EOF

        echo "âœ… HTML criado manualmente"
        echo "ğŸ“ Arquivos na pasta dist:"
        ls -la
        echo " "
        echo "ğŸ” Verificando caminhos no HTML:"
        grep -o 'src="[^"]*"' index.html
        grep -o 'href="[^"]*"' index.html
        
    - name: ğŸš€ Publicar
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        force_orphan: true
        
    - name: âœ… Final
      run: |
        echo "ğŸ‰ SITE NO AR!"
        echo "ğŸ‘‰ ACESSE: https://stylbandeira.github.io/coder-quest-folio"
        echo " "
        echo "âš ï¸  INSTRUÃ‡Ã•ES:"
        echo "1. Aguarde 2 minutos"
        echo "2. Abra o link acima"
        echo "3. APERTE Ctrl+F5 (force refresh)"
        echo "4. Se nÃ£o funcionar, APERTE F12 e me mostre os erros"